# 开发日志

## 项目名称：儿童绘本故事收集系统

### 2025-05-24

#### 1. 项目初始化
- [x] 初始化前端（React）与后端（Flask）项目结构
- [x] 配置本地开发环境，完成依赖安装
- [x] 初始化Git仓库并推送到GitHub

#### 2. 基础功能开发
- [x] 实现CSV文件上传功能，支持故事批量导入
- [x] 实现故事列表展示，支持按分类筛选
- [x] 前后端数据流转打通，上传后自动刷新列表

### 2025-05-25

#### 3. API集成与内容生成
- [x] 前端：增加"采集/生成故事"入口，支持API Key和偏好设置
- [x] 后端：完善`/api/collect`接口，调用硅基流动API，保存新故事
- [x] 设置组件优化：
  - 添加模型选择功能
  - 添加AI参数设置（温度、最大令牌数、Top P）
  - 实现设置持久化存储
  - 优化界面布局

#### 4. 数据导入与查重
- [x] 后端：上传时查重逻辑，防止重复故事入库
- [x] 前端：上传结果提示查重情况
- [x] 支持中文表头自动映射，兼容常见Excel导出格式

#### 5. 故事管理与展示
- [x] 故事列表重构为表格/列表模式，支持分类筛选、关键词搜索、简介预览、详情弹窗
- [x] 修复简介字段显示问题
- [x] 支持故事编辑、删除操作，含弹窗与全局提示

#### 6. 故事收集功能优化
- [x] 实现基于API的故事收集功能，支持指定数量和分类
- [x] 后端动态构建Prompt，将已有故事标题告知大模型用于去重
- [x] 后端实现本地查重和多次尝试补足逻辑
- [x] 前端增加采集进度显示和日志区域
- [x] 修复API调用400 Bad Request问题（Function call role更正）
- [x] 修复Prompt文件读取路径问题
- [x] 修复同名Prompt文件冲突问题
- [x] 优化Prompt指令，明确去重和分类要求
- [x] 修复AI返回内容不完整导致JSON解析失败的问题（提高API max_tokens限制）

---

## 下一阶段开发计划

#### 7. 高级功能与体验优化
- [ ] 支持分页与排序，提升大数据量下的浏览体验
- [ ] 故事导出功能（CSV/Excel）
- [ ] 故事批量删除、批量编辑
- [ ] 分类统计与可视化
- [ ] UI美化与响应式优化
- [ ] 用户权限与登录（如有需求）

---

> 每完成一个阶段任务，将在此日志同步更新进度。 