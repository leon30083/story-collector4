# AI对话上下文日志

## 项目简介
简要描述本项目的目标、主要功能和技术栈（1-3句话即可）。

---

## 当前开发阶段
- 当前主要目标/任务：
- 近期已完成的关键进展：
- 当前卡点/待解决问题：

---

## 重要决策与历史背景
- 关键设计决策（如架构、技术选型、重要约定等）：
- 以往遇到的主要问题及解决方案（可简要列举）：

---

## 需求与待办事项
- [ ] 需求1（简要描述，必要时可补充细节）
- [ ] 需求2
- [ ] 需求3
...

---

## AI协作建议
- 希望AI如何协助（如：代码实现、架构建议、Bug排查、文档撰写等）：
- 需要AI特别注意的事项（如：某些约定、风格、兼容性等）：

---

## 重要对话片段（AI历史问答精华）
- 2024-06-08：
  - 梳理并优化了AI协作上下文日志和Prompt的管理方式，所有AI协作相关文件（AI对话上下文.md、AI协作工作流使用说明.md、Prompt模板）已统一迁移至ai-collab/目录，并在prompts子目录下集中管理Prompt。
  - Prompt内容已升级，路径全部指向ai-collab/AI对话上下文.md，确保AI每次新会话都能准确加载上下文。
  - 明确了AI协作工作流的维护方法，包括日志维护、会话启动、对话片段整理、AI主动同步建议等。
  - 通过Cursor规则和Prompt，确保AI能主动提醒用户同步更新已解决的历史问题，保持日志与实际进度一致。
  - 目录结构和文件命名已标准化，便于长期维护和团队协作。

---

## 其他备注
- 任何你觉得AI需要知道的内容。

# 开发日志

## 项目名称：儿童绘本故事收集系统

### 2025-05-24

#### 1. 项目初始化
- [x] 初始化前端（React）与后端（Flask）项目结构
- [x] 配置本地开发环境，完成依赖安装
- [x] 初始化Git仓库并推送到GitHub

#### 2. 基础功能开发
- [x] 实现CSV文件上传功能，支持故事批量导入
- [x] 实现故事列表展示，支持按分类筛选
- [x] 前后端数据流转打通，上传后自动刷新列表

### 2025-05-25

#### 3. API集成与内容生成
- [x] 前端：增加"采集/生成故事"入口，支持API Key和偏好设置
- [x] 后端：完善`/api/collect`接口，调用硅基流动API，保存新故事
- [x] 设置组件优化：
  - 添加模型选择功能
  - 添加AI参数设置（温度、最大令牌数、Top P）
  - 实现设置持久化存储
  - 优化界面布局

#### 4. 数据导入与查重
- [x] 后端：上传时查重逻辑，防止重复故事入库
- [x] 前端：上传结果提示查重情况
- [x] 支持中文表头自动映射，兼容常见Excel导出格式

#### 5. 故事管理与展示
- [x] 故事列表重构为表格/列表模式，支持分类筛选、关键词搜索、简介预览、详情弹窗
- [x] 修复简介字段显示问题
- [x] 支持故事编辑、删除操作，含弹窗与全局提示

#### 6. 故事收集功能优化
- [x] 实现基于API的故事收集功能，支持指定数量和分类
- [x] 后端动态构建Prompt，将已有故事标题告知大模型用于去重
- [x] 后端实现本地查重和多次尝试补足逻辑
- [x] 前端增加采集进度显示和日志区域
- [x] 修复API调用400 Bad Request问题（Function call role更正）
- [x] 修复Prompt文件读取路径问题
- [x] 修复同名Prompt文件冲突问题
- [x] 优化Prompt指令，明确去重和分类要求
- [x] 修复AI返回内容不完整导致JSON解析失败的问题（提高API max_tokens限制）

---

## 下一阶段开发计划

#### 7. 高级功能与体验优化
- [ ] 支持分页与排序，提升大数据量下的浏览体验
- [ ] 故事导出功能（CSV/Excel）
- [ ] 故事批量删除、批量编辑
- [ ] 分类统计与可视化
- [ ] UI美化与响应式优化
- [ ] 用户权限与登录（如有需求）

---

> 每完成一个阶段任务，将在此日志同步更新进度。 