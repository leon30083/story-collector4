# 开发指南与关键文件导航

本指南面向"儿童绘本故事收集与结构化创作平台"全体开发者，梳理项目架构、数据流、API地图、代码关系、UI原型、AI协作机制等，详细列出所有关键文件及其用途、路径，便于后续开发、联调与团队协作。

---

## 一、项目结构与核心目录

- **前端主目录**：`frontend/src/components/`
- **后端主目录**：`backend/`
- **数据与知识库**：`text/`
- **AI协作与日志**：`ai-collab/`
- **UI原型与设计文档**：`text/UI原型参考/`

---

## 二、数据结构与知识库文件

- **风格模板数据**：
  - 路径：`text/ai_picturebook_styles.json`
  - 用途：存储所有绘本风格模板，供风格推荐、AI生成、经典改编等功能调用。
- **经典改编规则**：
  - 路径：`text/经典改编.md`
  - 用途：详细说明经典故事改编原则、流程、风格适配，供AI与前端经典改编流程调用。
- **Prompt与采集指令**：
  - 路径：`ai-collab/prompts/ai-collab-prompt.txt`
  - 用途：AI协作、采集、生成等核心指令模板，所有AI调用均以此为准。

---

## 三、后端API地图与代码关系

- **主API入口**：
  - 路径：`backend/app.py`
  - 说明：Flask主应用，注册所有蓝图，定义上传、采集、故事管理、分类、导出等RESTful接口。
- **数据库模型**：
  - 路径：`backend/models.py`
  - 说明：定义Story、Category、Style、Prompt、ImageTask、ExportTask等核心数据表结构。
- **API蓝图拆分**：
  - 项目管理：`backend/project_api.py`
  - 风格与模板：`backend/style_api.py`
  - 脚本与分镜：`backend/script_api.py`
  - Prompt管理：`backend/prompt_api.py`
  - 图像生成：`backend/image_api.py`
  - 资产导出：`backend/export_api.py`
  - 系统设置：`backend/settings_api.py`
- **数据库初始化与迁移**：
  - `backend/db_init.py`、`backend/fill_styles.py`、`backend/add_batch_column.py`等
- **测试用例与工具**：
  - `backend/test_api.py`（API测试）、`backend/check_db_schema.py`（结构校验）等

---

## 四、前端页面与组件关系

- **首页/故事库总览**：
  - 主组件：`StoryLibraryPage.jsx`
  - 列表与批量操作：`StoryList.js`
  - 分类管理：`CategoryManager.js`
  - 故事导入：`StoryUpload.js`
  - 统计区：可新建`StatisticBar`或在主组件实现
- **结构化编辑器与创作流程**：
  - 分步编辑：`CreationStep0BasicInfo.jsx` ~ `CreationStep3Images.jsx`
  - AI采集与管理：`StoryCollector.js`、`StoryCollect.js`
  - Prompt与风格管理：`PromptManagerModal.jsx`、`APISettingsModal.jsx`
  - 导出与仪表盘：`ExportModal.jsx`、`ProjectDashboardModal.jsx`
- **UI原型与详细解读**：
  - 图片：`text/UI原型参考/1.png` ~ `6.png`
  - 说明文档：`text/UI原型参考/UI原型图片详细解读.md`

---

## 五、AI协作机制与日志

- **AI对话上下文日志**：
  - 路径：`ai-collab/AI对话上下文.md`
  - 用途：记录项目进展、决策、需求、历史问答、开发日志，是AI协作的"记忆体"。
- **AI协作工作流说明**：
  - 路径：`ai-collab/AI协作工作流使用说明.md`
  - 用途：规范AI协作流程、日志维护、上下文加载、对话片段整理等。
- **首页开发方案与风险分析**：
  - 路径：`ai-collab/首页故事库开发方案与风险分析.md`
  - 用途：首页组件结构、mock与API切换、批量操作、风险应对等详细方案。

---

## 六、开发流程与协作建议

1. **数据库建模与迁移**：优先梳理`models.py`，用迁移脚本初始化/升级数据表。
2. **后端API实现**：主入口`app.py`注册各模块蓝图，接口参数与数据结构严格参照模型与文档。
3. **前端页面开发**：严格对照UI原型与详细解读，组件复用、props、事件流保持一致。
4. **联调与测试**：用`test_api.py`等工具全量测试API，前后端数据结构保持同步。
5. **文档与日志同步**：所有进展、决策、问题、历史问答及时补充到`AI对话上下文.md`。
6. **AI协作与Prompt管理**：所有AI调用、采集、生成、风格推荐等均以`ai-collab/prompts/ai-collab-prompt.txt`为准，遇到不明事项优先查阅日志并主动提问。

---

## 七、常见问题与快速索引

- **风格模板如何扩展？** 直接编辑`text/ai_picturebook_styles.json`，前后端均自动读取。
- **经典改编流程如何接入？** 参照`text/经典改编.md`，前端经典改编入口自动加载规则。
- **API参数/字段不一致？** 以`backend/models.py`为准，必要时同步前端mock数据结构。
- **AI协作失效/上下文丢失？** 立即查阅`ai-collab/AI对话上下文.md`，补全关键信息。
- **UI设计细节不明？** 参见`text/UI原型参考/UI原型图片详细解读.md`及原型图片。

---

如需进一步细化某一模块、接口、数据结构或遇到特殊协作场景，请优先查阅本指南及相关关键文件，仍有疑问可随时@AI协作助手。 